<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Complet: Les Fondamentaux de la Finance Quantitative</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
        }
        .bg-gradient-red {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        .text-gradient {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .shadow-red {
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.1);
        }
        .border-red-custom {
            border-color: #dc2626;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .calculator-input {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            transition: border-color 0.3s ease;
        }
        .calculator-input:focus {
            border-color: #dc2626;
            outline: none;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        .cta-button {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3);
        }
        .formula-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            margin: 12px 0;
            font-size: 0.9rem;
        }
        .interactive-calculator {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border: 2px solid #dc2626;
        }
        .chart-container {
            height: 400px;
            margin: 20px 0;
            position: relative;
        }
        .section-divider {
            height: 3px;
            background: linear-gradient(90deg, #dc2626, #b91c1c);
            margin: 30px 0;
            border-radius: 2px;
        }
        .distribution-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            border: 1px solid #e5e7eb;
        }
        .result-box {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .pricer-result {
            font-size: 1.2rem;
            font-weight: 600;
            color: #dc2626;
        }
        @media print {
            body { print-color-adjust: exact; }
            .no-print { display: none; }
        }
        
        /* Optimisation pour PDF - page continue */
        .section {
            break-inside: avoid;
            margin-bottom: 2rem;
        }
        
        .page-container {
            max-width: none;
            padding: 0;
        }
        
        @page {
            size: A4;
            margin: 1cm;
        }
    </style>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>
<body class="bg-white text-gray-900">
    <!-- Header -->
    <header class="bg-white text-gray-900 pt-8 pb-6 border-b-4 border-red-600">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="flex justify-center mb-4">
                <img src="https://i.imgur.com/bpq2VrC.png" alt="Finance Tutoring Logo" class="h-32 object-contain">
            </div>
            
            <h1 class="text-xl font-semibold text-red-600 mb-2">Finance Tutoring</h1>
            <p class="text-sm text-red-500 mb-4">Excellence en Formation Financière</p>
            
            <h1 class="text-3xl font-bold text-gradient mb-3">Guide Complet: Les Fondamentaux de la Finance Quantitative</h1>
            <p class="text-lg text-gray-700 max-w-4xl mx-auto mb-6">Maîtrisez les mathématiques financières, les modèles de pricing, le risk management et les applications pratiques avec des outils interactifs avancés.</p>
            
            <div class="bg-gray-50 p-4 rounded-lg border border-red-200">
                <h3 class="text-md font-semibold text-red-600 mb-3">Ce guide complet inclut :</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                    <div><i class="fas fa-calculator text-green-500 mr-2"></i>Pricers interactifs (Black-Scholes, Heston, Monte Carlo)</div>
                    <div><i class="fas fa-chart-line text-blue-500 mr-2"></i>Comparaisons détaillées des distributions</div>
                    <div><i class="fas fa-function text-purple-500 mr-2"></i>Mathématiques financières avancées</div>
                    <div><i class="fas fa-shield-alt text-orange-500 mr-2"></i>Risk Management quantitatif</div>
                    <div><i class="fas fa-robot text-indigo-500 mr-2"></i>Trading algorithmique</div>
                    <div><i class="fas fa-brain text-pink-500 mr-2"></i>Machine Learning en finance</div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-6">
        
        <!-- Section 1: Contexte et Fondamentaux -->
        <section class="section mb-8">
            <div class="bg-white p-6 rounded-lg shadow-red border-l-4 border-red-custom">
                <h2 class="text-2xl font-bold text-gradient mb-4">1. Contexte Actuel et Enjeux de la Finance Quantitative</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <p class="text-gray-700 leading-relaxed mb-3 text-sm">
                            Dans un environnement de <strong class="text-red-600">complexité croissante</strong> des produits structurés, la finance quantitative est devenue le pilier central de l'industrie financière moderne. Les évolutions réglementaires (FRTB, Basel IV), la digitalisation des marchés, et l'émergence de nouvelles classes d'actifs exigent une maîtrise technique approfondie.
                        </p>
                        <p class="text-gray-700 leading-relaxed text-sm">
                            L'explosion des données (Big Data) et l'avènement de l'intelligence artificielle transforment radicalement les approches traditionnelles de pricing, de risk management et de trading.
                        </p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-md mb-3 text-red-600">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Enjeux Stratégiques 2024-2025
                        </h3>
                        <ul class="space-y-2 text-xs">
                            <li><i class="fas fa-chart-line text-red-500 mr-2"></i><strong>Volatilité Extrême:</strong> Gestion des risques dans des marchés hypercorrelatés</li>
                            <li><i class="fas fa-balance-scale text-blue-500 mr-2"></i><strong>Réglementation:</strong> FRTB, Basel IV, DORA - Impact sur les modèles</li>
                            <li><i class="fas fa-brain text-purple-500 mr-2"></i><strong>IA/ML:</strong> Intégration de l'intelligence artificielle</li>
                            <li><i class="fas fa-layer-group text-green-500 mr-2"></i><strong>Produits Complexes:</strong> Structuration d'instruments sophistiqués</li>
                            <li><i class="fas fa-globe text-orange-500 mr-2"></i><strong>ESG/Climat:</strong> Quantification des risques climatiques</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Distributions de Probabilité avec Comparaisons Interactives -->
        <section class="section mb-8">
            <h2 class="text-2xl font-bold text-gradient mb-4">2. Distributions de Probabilité et Comparaisons Interactives</h2>
            
            <!-- Graphique comparatif des distributions -->
            <div class="distribution-card mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-600">
                    <i class="fas fa-chart-area mr-2"></i>Comparaison Interactive des Distributions
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Paramètres des Distributions</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium mb-1">Normale - Moyenne (μ)</label>
                                <input type="number" id="normalMu" class="calculator-input w-full" value="0" step="0.1" onchange="updateDistributionChart()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Normale - Écart-type (σ)</label>
                                <input type="number" id="normalSigma" class="calculator-input w-full" value="1" step="0.1" min="0.1" onchange="updateDistributionChart()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Student-t - Degrés de liberté (ν)</label>
                                <input type="number" id="studentNu" class="calculator-input w-full" value="3" step="1" min="1" onchange="updateDistributionChart()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Pareto - Paramètre α</label>
                                <input type="number" id="paretoAlpha" class="calculator-input w-full" value="2" step="0.1" min="0.1" onchange="updateDistributionChart()">
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tableau comparatif des caractéristiques -->
            <div class="distribution-card mb-6">
                <h3 class="text-lg font-semibold mb-4 text-red-600">
                    <i class="fas fa-table mr-2"></i>Caractéristiques des Distributions
                </h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead class="bg-red-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-sm font-medium text-red-600">Distribution</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-red-600">Densité</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-red-600">Paramètres</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-red-600">Kurtosis</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-red-600">Applications Finance</th>
                            </tr>
                        </thead>
                        <tbody class="text-xs">
                            <tr class="border-t">
                                <td class="px-4 py-2 font-semibold">Normale</td>
                                <td class="px-4 py-2">$f(x) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$</td>
                                <td class="px-4 py-2">μ (moyenne), σ (écart-type)</td>
                                <td class="px-4 py-2">3 (mesokurticité)</td>
                                <td class="px-4 py-2">Rendements, modèle Black-Scholes</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2 font-semibold">Log-Normale</td>
                                <td class="px-4 py-2">$f(x) = \frac{1}{x\sigma\sqrt{2\pi}} e^{-\frac{(\ln x - \mu)^2}{2\sigma^2}}$</td>
                                <td class="px-4 py-2">μ, σ (de ln(X))</td>
                                <td class="px-4 py-2">> 3 (leptokurtique)</td>
                                <td class="px-4 py-2">Prix d'actifs, volatilité</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2 font-semibold">Student-t</td>
                                <td class="px-4 py-2">$f(x) = \frac{\Gamma(\frac{\nu+1}{2})}{\sqrt{\nu\pi}\Gamma(\frac{\nu}{2})}(1+\frac{x^2}{\nu})^{-\frac{\nu+1}{2}}$</td>
                                <td class="px-4 py-2">ν (degrés de liberté)</td>
                                <td class="px-4 py-2">> 3 (queues épaisses)</td>
                                <td class="px-4 py-2">Événements extrêmes, VaR</td>
                            </tr>
                            <tr class="border-t">
                                <td class="px-4 py-2 font-semibold">Pareto</td>
                                <td class="px-4 py-2">$f(x) = \frac{\alpha x_m^\alpha}{x^{\alpha+1}}$ pour $x \geq x_m$</td>
                                <td class="px-4 py-2">α (forme), $x_m$ (minimum)</td>
                                <td class="px-4 py-2">Infinie si α ≤ 4</td>
                                <td class="px-4 py-2">Pertes opérationnelles, tail risk</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calculateur de moments statistiques -->
            <div class="interactive-calculator">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-calculator mr-2"></i>Calculateur de Moments Statistiques
                </h3>
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Type de Distribution</label>
                        <select id="distType" class="calculator-input w-full" onchange="calculateMoments()">
                            <option value="normal">Normale</option>
                            <option value="lognormal">Log-Normale</option>
                            <option value="student">Student-t</option>
                            <option value="pareto">Pareto</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Paramètre 1</label>
                        <input type="number" id="param1" class="calculator-input w-full" value="0" step="0.1" onchange="calculateMoments()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Paramètre 2</label>
                        <input type="number" id="param2" class="calculator-input w-full" value="1" step="0.1" onchange="calculateMoments()">
                    </div>
                </div>
                <div id="momentsResult" class="result-box mt-4"></div>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Section 3: Pricers Interactifs -->
        <section class="section mb-8">
            <h2 class="text-2xl font-bold text-gradient mb-4">3. Pricers d'Options Interactifs</h2>
            
            <!-- Black-Scholes Pricer -->
            <div class="interactive-calculator mb-6">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-chart-line mr-2"></i>Pricer Black-Scholes (Options Européennes)
                </h3>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Prix Spot (S₀)</label>
                        <input type="number" id="bsSpot" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Strike (K)</label>
                        <input type="number" id="bsStrike" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Volatilité (%)</label>
                        <input type="number" id="bsVolatility" class="calculator-input w-full" value="20" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Temps à maturité (années)</label>
                        <input type="number" id="bsMaturity" class="calculator-input w-full" value="1" step="0.01">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Taux sans risque (%)</label>
                        <input type="number" id="bsRate" class="calculator-input w-full" value="5" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Type d'option</label>
                        <select id="bsType" class="calculator-input w-full">
                            <option value="call">Call</option>
                            <option value="put">Put</option>
                        </select>
                    </div>
                </div>
                <button onclick="calculateBlackScholes()" class="cta-button mb-4">
                    <i class="fas fa-calculator mr-2"></i>Calculer Prix et Grecques
                </button>
                <div id="bsResults" class="grid md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Monte Carlo Pricer -->
            <div class="interactive-calculator mb-6">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-dice mr-2"></i>Pricer Monte Carlo (Options Exotiques)
                </h3>
                <div class="grid md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Type d'option</label>
                        <select id="mcType" class="calculator-input w-full">
                            <option value="european">Européenne</option>
                            <option value="asian">Asiatique</option>
                            <option value="barrier">Barrière</option>
                            <option value="lookback">Lookback</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Prix Spot</label>
                        <input type="number" id="mcSpot" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Strike</label>
                        <input type="number" id="mcStrike" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Nb Simulations</label>
                        <input type="number" id="mcSims" class="calculator-input w-full" value="10000" step="1000">
                    </div>
                </div>
                <button onclick="calculateMonteCarlo()" class="cta-button mb-4">
                    <i class="fas fa-play mr-2"></i>Lancer Simulation
                </button>
                <div id="mcResults"></div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="mcChart"></canvas>
                </div>
            </div>

            <!-- Heston Model Pricer -->
            <div class="interactive-calculator">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-wave-square mr-2"></i>Modèle de Heston (Volatilité Stochastique)
                </h3>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Prix Spot</label>
                        <input type="number" id="hestonS0" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Strike</label>
                        <input type="number" id="hestonK" class="calculator-input w-full" value="100" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Volatilité initiale (v₀)</label>
                        <input type="number" id="hestonV0" class="calculator-input w-full" value="0.04" step="0.01">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Kappa (κ)</label>
                        <input type="number" id="hestonKappa" class="calculator-input w-full" value="2" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Theta (θ)</label>
                        <input type="number" id="hestonTheta" class="calculator-input w-full" value="0.04" step="0.01">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Corrélation (ρ)</label>
                        <input type="number" id="hestonRho" class="calculator-input w-full" value="-0.7" step="0.1" min="-1" max="1">
                    </div>
                </div>
                <button onclick="calculateHeston()" class="cta-button mb-4">
                    <i class="fas fa-calculator mr-2"></i>Calculer Prix Heston
                </button>
                <div id="hestonResults"></div>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Section 4: Risk Management et VaR -->
        <section class="section mb-8">
            <h2 class="text-2xl font-bold text-gradient mb-4">4. Risk Management Quantitatif</h2>
            
            <!-- VaR Calculator -->
            <div class="interactive-calculator mb-6">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-shield-alt mr-2"></i>Calculateur VaR Multi-Méthodes
                </h3>
                <div class="grid md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Méthode VaR</label>
                        <select id="varMethod" class="calculator-input w-full">
                            <option value="parametric">Paramétrique (Normale)</option>
                            <option value="historical">Historique</option>
                            <option value="montecarlo">Monte Carlo</option>
                            <option value="student">Paramétrique (Student-t)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Niveau de confiance (%)</label>
                        <input type="number" id="varConfidence" class="calculator-input w-full" value="95" step="0.1" min="90" max="99.9">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Horizon (jours)</label>
                        <input type="number" id="varHorizon" class="calculator-input w-full" value="1" step="1" min="1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Valeur du portefeuille</label>
                        <input type="number" id="varPortfolio" class="calculator-input w-full" value="1000000" step="10000">
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Volatilité annuelle (%)</label>
                        <input type="number" id="varVolatility" class="calculator-input w-full" value="20" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Rendement moyen annuel (%)</label>
                        <input type="number" id="varMean" class="calculator-input w-full" value="8" step="0.1">
                    </div>
                </div>
                <button onclick="calculateVaR()" class="cta-button mb-4">
                    <i class="fas fa-chart-bar mr-2"></i>Calculer VaR et Expected Shortfall
                </button>
                <div id="varResults"></div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="varChart"></canvas>
                </div>
            </div>

            <!-- Stress Testing -->
            <div class="distribution-card">
                <h3 class="text-lg font-semibold mb-4 text-red-600">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Stress Testing et Scénarios Historiques
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Scénarios Historiques Majeurs</h4>
                        <div class="space-y-3 text-sm">
                            <div class="bg-red-50 p-3 rounded border border-red-200">
                                <strong>Krach 1987 :</strong> -22% en un jour (19 octobre)<br>
                                <span class="text-xs text-gray-600">Impact sur portefeuille actions : VaR x 5</span>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                                <strong>Crise LTCM 1998 :</strong> Éclatement spreads de crédit<br>
                                <span class="text-xs text-gray-600">Corrélations → 1, liquidité évaporée</span>
                            </div>
                            <div class="bg-blue-50 p-3 rounded border border-blue-200">
                                <strong>Crise 2008 :</strong> Credit crunch + volatilité extrême<br>
                                <span class="text-xs text-gray-600">VIX > 80, spreads CDS x 10</span>
                            </div>
                            <div class="bg-purple-50 p-3 rounded border border-purple-200">
                                <strong>COVID Mars 2020 :</strong> Chute -35% en 3 semaines<br>
                                <span class="text-xs text-gray-600">Toutes classes d'actifs corrélées</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">Tests de Validation (Backtesting)</h4>
                        <div class="formula-box text-xs">
                            <strong>Test de Kupiec (Coverage) :</strong><br>
                            $LR_{UC} = -2\ln\left[\frac{(1-p)^{T-N}p^N}{(1-\hat{p})^{T-N}\hat{p}^N}\right] \sim \chi^2(1)$
                        </div>
                        <div class="formula-box text-xs">
                            <strong>Test de Christoffersen (Independence) :</strong><br>
                            Vérifie que les violations ne sont pas clustérisées
                        </div>
                        <div class="bg-green-50 p-3 rounded border border-green-200 text-sm">
                            <strong>Critères de validation :</strong>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>• Nombre de violations conforme au niveau théorique</li>
                                <li>• Violations indépendantes dans le temps</li>
                                <li>• Taille moyenne des violations raisonnable</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Section 5: Mathématiques Financières Avancées -->
        <section class="section mb-8">
            <h2 class="text-2xl font-bold text-gradient mb-4">5. Mathématiques Financières et Calcul Stochastique</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- EDS et Lemme d'Itô -->
                <div class="distribution-card">
                    <h3 class="font-semibold text-lg mb-3 text-red-600">
                        <i class="fas fa-function mr-2"></i>Équations Différentielles Stochastiques
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div>
                            <strong class="text-blue-600">Mouvement Brownien Géométrique :</strong>
                            <div class="formula-box text-xs">
                                $dS_t = \mu S_t dt + \sigma S_t dW_t$<br>
                                Solution : $S_t = S_0 \exp\left((\mu - \frac{\sigma^2}{2})t + \sigma W_t\right)$
                            </div>
                        </div>
                        <div>
                            <strong class="text-green-600">Processus d'Ornstein-Uhlenbeck :</strong>
                            <div class="formula-box text-xs">
                                $dX_t = \kappa(\theta - X_t)dt + \sigma dW_t$<br>
                                (Retour vers la moyenne)
                            </div>
                        </div>
                        <div>
                            <strong class="text-purple-600">Processus CIR :</strong>
                            <div class="formula-box text-xs">
                                $dr_t = \kappa(\theta - r_t)dt + \sigma\sqrt{r_t} dW_t$<br>
                                (Taux toujours positifs si $2\kappa\theta \geq \sigma^2$)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lemme d'Itô -->
                <div class="distribution-card">
                    <h3 class="font-semibold text-lg mb-3 text-red-600">
                        <i class="fas fa-integral mr-2"></i>Lemme d'Itô et Applications
                    </h3>
                    <div class="formula-box text-sm mb-4">
                        <strong>Forme générale :</strong><br>
                        Pour $f(t, X_t)$ où $dX_t = \mu_t dt + \sigma_t dW_t$ :<br>
                        $df = \left(\frac{\partial f}{\partial t} + \mu_t \frac{\partial f}{\partial x} + \frac{1}{2}\sigma_t^2 \frac{\partial^2 f}{\partial x^2}\right)dt + \sigma_t \frac{\partial f}{\partial x}dW_t$
                    </div>
                    <div class="space-y-3 text-sm">
                        <div class="bg-blue-50 p-3 rounded border border-blue-200">
                            <strong>Table de multiplication :</strong><br>
                            <span class="text-xs">$dt \cdot dt = 0$, $dt \cdot dW_t = 0$, $dW_t \cdot dW_t = dt$</span>
                        </div>
                        <div class="bg-green-50 p-3 rounded border border-green-200">
                            <strong>Exemple classique :</strong><br>
                            <span class="text-xs">$X_t = \ln(S_t) \Rightarrow dX_t = (\mu - \frac{\sigma^2}{2})dt + \sigma dW_t$</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mesures de probabilité -->
            <div class="distribution-card mt-6">
                <h3 class="font-semibold text-lg mb-4 text-red-600">
                    <i class="fas fa-balance-scale mr-2"></i>Mesures de Probabilité et Théorème de Girsanov
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3 text-blue-600">Mesure Physique (ℙ)</h4>
                        <div class="formula-box text-xs mb-3">
                            $dS_t = \mu S_t dt + \sigma S_t dW_t^{\mathbb{P}}$<br>
                            où $\mu$ = drift réel (> r)
                        </div>
                        <div class="text-xs text-gray-600">
                            <strong>Usage :</strong> Analyse de risque, backtesting, prévisions
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3 text-green-600">Mesure Risque-Neutre (ℚ)</h4>
                        <div class="formula-box text-xs mb-3">
                            $dS_t = r S_t dt + \sigma S_t dW_t^{\mathbb{Q}}$<br>
                            où $r$ = taux sans risque
                        </div>
                        <div class="text-xs text-gray-600">
                            <strong>Usage :</strong> Pricing d'instruments dérivés
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <h4 class="font-semibold mb-3 text-purple-600">Changement de Mesure (Théorème de Girsanov)</h4>
                    <div class="formula-box text-sm">
                        <strong>Densité de Radon-Nikodym :</strong><br>
                        $\frac{d\mathbb{Q}}{d\mathbb{P}} = \exp\left(-\int_0^T \lambda_s dW_s^{\mathbb{P}} - \frac{1}{2}\int_0^T \lambda_s^2 ds\right)$<br>
                        où $\lambda_t = \frac{\mu_t - r}{\sigma_t}$ (prime de risque de marché)
                    </div>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- Section 6: Trading Algorithmique et Applications -->
        <section class="section mb-8">
            <h2 class="text-2xl font-bold text-gradient mb-4">6. Trading Algorithmique et Machine Learning</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Algorithmes d'exécution -->
                <div class="distribution-card">
                    <h3 class="font-semibold text-lg mb-3 text-red-600">
                        <i class="fas fa-robot mr-2"></i>Algorithmes d'Exécution
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div class="bg-blue-50 p-3 rounded border border-blue-200">
                            <strong>TWAP (Time-Weighted Average Price) :</strong><br>
                            <span class="text-xs">Répartition uniforme dans le temps : $Q_i = \frac{Q_{total}}{n}$</span>
                        </div>
                        <div class="bg-green-50 p-3 rounded border border-green-200">
                            <strong>VWAP (Volume-Weighted Average Price) :</strong><br>
                            <span class="text-xs">Suit le profil de volume historique intraday</span>
                        </div>
                        <div class="bg-purple-50 p-3 rounded border border-purple-200">
                            <strong>Implementation Shortfall (Almgren-Chriss) :</strong><br>
                            <span class="text-xs">Optimise trade-off impact vs risque temporel</span>
                        </div>
                    </div>
                    
                    <h4 class="font-semibold mt-4 mb-2 text-orange-600">Microstructure et Coûts</h4>
                    <div class="formula-box text-xs">
                        <strong>Décomposition des coûts :</strong><br>
                        Coût Total = Spread + Impact + Timing + Opportunité
                    </div>
                </div>

                <!-- Machine Learning Applications -->
                <div class="distribution-card">
                    <h3 class="font-semibold text-lg mb-3 text-red-600">
                        <i class="fas fa-brain mr-2"></i>Machine Learning en Finance
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="bg-indigo-50 p-3 rounded border border-indigo-200">
                            <strong>Prédiction de Prix :</strong><br>
                            <span class="text-xs">LSTM, Random Forest, SVM pour séries temporelles</span>
                        </div>
                        <div class="bg-pink-50 p-3 rounded border border-pink-200">
                            <strong>Détection d'Anomalies :</strong><br>
                            <span class="text-xs">Isolation Forest, One-Class SVM pour fraudes</span>
                        </div>
                        <div class="bg-teal-50 p-3 rounded border border-teal-200">
                            <strong>Optimisation de Portefeuille :</strong><br>
                            <span class="text-xs">Reinforcement Learning, Genetic Algorithms</span>
                        </div>
                        <div class="bg-orange-50 p-3 rounded border border-orange-200">
                            <strong>NLP Financier :</strong><br>
                            <span class="text-xs">Sentiment analysis, extraction d'entités</span>
                        </div>
                    </div>
                    
                    <h4 class="font-semibold mt-4 mb-2 text-green-600">Métriques de Performance</h4>
                    <div class="text-xs space-y-1">
                        <div>• <strong>Sharpe Ratio :</strong> $\frac{E[R_p] - R_f}{\sigma_p}$</div>
                        <div>• <strong>Maximum Drawdown :</strong> Perte maximale depuis un pic</div>
                        <div>• <strong>Calmar Ratio :</strong> $\frac{\text{Rendement annuel}}{\text{Max Drawdown}}$</div>
                        <div>• <strong>Information Ratio :</strong> $\frac{\text{Excès de rendement}}{\text{Tracking Error}}$</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Objectifs et Conclusion -->
        <section class="section mb-6">
            <div class="bg-gradient-red text-white p-6 rounded-lg">
                <h2 class="text-2xl font-bold mb-4">Excellence en Finance Quantitative</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <p class="text-red-100 leading-relaxed mb-3 text-sm">
                            Ce guide complet vous a fourni les outils essentiels pour exceller en finance quantitative moderne. De la théorie des probabilités aux applications en intelligence artificielle, chaque concept est accompagné d'outils interactifs pour une compréhension pratique immédiate.
                        </p>
                        <p class="text-red-100 leading-relaxed text-sm">
                            Les pricers interactifs, calculateurs de risque et comparaisons de distributions vous permettent d'expérimenter et de valider vos connaissances théoriques en temps réel.
                        </p>
                    </div>
                    <div class="bg-white bg-opacity-10 p-4 rounded-lg">
                        <h3 class="font-semibold text-md mb-3">Compétences Maîtrisées</h3>
                        <ul class="space-y-1 text-sm text-red-100">
                            <li>✓ Distributions de probabilité et comparaisons interactives</li>
                            <li>✓ Pricers Black-Scholes, Heston et Monte Carlo</li>
                            <li>✓ Risk Management et calculs VaR multi-méthodes</li>
                            <li>✓ Mathématiques financières et calcul stochastique</li>
                            <li>✓ Trading algorithmique et microstructure</li>
                            <li>✓ Applications Machine Learning en finance</li>
                            <li>✓ Stress testing et validation de modèles</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t border-red-400">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                                <i class="fas fa-graduation-cap text-red-600 text-lg"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-sm">Finance Tutoring</h4>
                                <p class="text-xs text-red-200">Excellence en Formation Financière</p>
                            </div>
                        </div>
                        <div class="text-right text-xs text-red-200">
                            <p>Guide interactif complet - Décembre 2024</p>
                            <p>Tous droits réservés</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- JavaScript pour toutes les fonctionnalités -->
    <script>
        // Variables globales pour les graphiques
        let distributionChart, mcChart, varChart;

        // Fonctions mathématiques utilitaires
        function normalPDF(x, mu = 0, sigma = 1) {
            return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
        }

        function normalCDF(x, mu = 0, sigma = 1) {
            return 0.5 * (1 + erf((x - mu) / (sigma * Math.sqrt(2))));
        }

        function erf(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return sign * y;
        }

        function studentTPDF(x, nu) {
            const gamma1 = gamma((nu + 1) / 2);
            const gamma2 = gamma(nu / 2);
            return gamma1 / (Math.sqrt(nu * Math.PI) * gamma2) * Math.pow(1 + x * x / nu, -(nu + 1) / 2);
        }

        function gamma(x) {
            // Approximation de Lanczos pour la fonction gamma
            const g = 7;
            const C = [0.99999999999980993, 676.5203681218851, -1259.1392167224028,
                      771.32342877765313, -176.61502916214059, 12.507343278686905,
                      -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
            
            if (x < 0.5) return Math.PI / (Math.sin(Math.PI * x) * gamma(1 - x));
            
            x -= 1;
            let a = C[0];
            for (let i = 1; i < g + 2; i++) a += C[i] / (x + i);
            
            const t = x + g + 0.5;
            return Math.sqrt(2 * Math.PI) * Math.pow(t, x + 0.5) * Math.exp(-t) * a;
        }

        function paretoPDF(x, alpha, xm = 1) {
            if (x < xm) return 0;
            return alpha * Math.pow(xm, alpha) / Math.pow(x, alpha + 1);
        }

        // Initialisation des graphiques
        window.onload = function() {
            updateDistributionChart();
            calculateMoments();
        };

        // Mise à jour du graphique de comparaison des distributions
        function updateDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            const mu = parseFloat(document.getElementById('normalMu').value);
            const sigma = parseFloat(document.getElementById('normalSigma').value);
            const nu = parseFloat(document.getElementById('studentNu').value);
            const alpha = parseFloat(document.getElementById('paretoAlpha').value);
            
            const xValues = [];
            const normalValues = [];
            const studentValues = [];
            const paretoValues = [];
            const lognormalValues = [];
            
            for (let x = -4; x <= 4; x += 0.1) {
                xValues.push(x);
                normalValues.push(normalPDF(x, mu, sigma));
                studentValues.push(studentTPDF(x, nu));
                
                if (x > 0) {
                    paretoValues.push(paretoPDF(x, alpha, 0.5));
                    lognormalValues.push((1 / (x * sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((Math.log(x) - mu) / sigma, 2)));
                } else {
                    paretoValues.push(0);
                    lognormalValues.push(0);
                }
            }
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            distributionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: xValues.map(x => x.toFixed(1)),
                    datasets: [
                        {
                            label: 'Normale',
                            data: normalValues,
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'Student-t',
                            data: studentValues,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'Log-normale',
                            data: lognormalValues,
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'Pareto',
                            data: paretoValues,
                            borderColor: '#ca8a04',
                            backgroundColor: 'rgba(202, 138, 4, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparaison des Densités de Probabilité',
                            font: { size: 14 }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'x' }
                        },
                        y: {
                            title: { display: true, text: 'f(x)' }
                        }
                    }
                }
            });
        }

        // Calcul des moments statistiques
        function calculateMoments() {
            const distType = document.getElementById('distType').value;
            const param1 = parseFloat(document.getElementById('param1').value);
            const param2 = parseFloat(document.getElementById('param2').value);
            
            let result = '';
            
            switch(distType) {
                case 'normal':
                    const mu = param1;
                    const sigma = param2;
                    result = `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-green-600">Paramètres</h4>
                                <p class="text-sm">μ (moyenne) = ${mu}</p>
                                <p class="text-sm">σ (écart-type) = ${sigma}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-green-600">Moments</h4>
                                <p class="text-sm">Moyenne = ${mu}</p>
                                <p class="text-sm">Variance = ${(sigma * sigma).toFixed(4)}</p>
                                <p class="text-sm">Skewness = 0</p>
                                <p class="text-sm">Kurtosis = 3</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'lognormal':
                    const meanLog = param1;
                    const sigmaLog = param2;
                    const mean = Math.exp(meanLog + sigmaLog * sigmaLog / 2);
                    const variance = (Math.exp(sigmaLog * sigmaLog) - 1) * Math.exp(2 * meanLog + sigmaLog * sigmaLog);
                    result = `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-green-600">Paramètres</h4>
                                <p class="text-sm">μ (ln) = ${meanLog}</p>
                                <p class="text-sm">σ (ln) = ${sigmaLog}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-green-600">Moments</h4>
                                <p class="text-sm">Moyenne = ${mean.toFixed(4)}</p>
                                <p class="text-sm">Variance = ${variance.toFixed(4)}</p>
                                <p class="text-sm">Skewness > 0 (asymétrie positive)</p>
                                <p class="text-sm">Kurtosis > 3 (leptokurtique)</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'student':
                    const nu = param1;
                    const mean_t = nu > 1 ? 0 : "Non définie";
                    const var_t = nu > 2 ? nu / (nu - 2) : "Non définie";
                    const kurt_t = nu > 4 ? 6 / (nu - 4) + 3 : "Non définie";
                    result = `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-green-600">Paramètres</h4>
                                <p class="text-sm">ν (degrés de liberté) = ${nu}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-green-600">Moments</h4>
                                <p class="text-sm">Moyenne = ${mean_t}</p>
                                <p class="text-sm">Variance = ${var_t}</p>
                                <p class="text-sm">Skewness = 0 (si ν > 3)</p>
                                <p class="text-sm">Kurtosis = ${kurt_t}</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'pareto':
                    const alpha_p = param1;
                    const xm = param2;
                    const mean_p = alpha_p > 1 ? (alpha_p * xm) / (alpha_p - 1) : "Non définie";
                    const var_p = alpha_p > 2 ? (xm * xm * alpha_p) / ((alpha_p - 1) * (alpha_p - 1) * (alpha_p - 2)) : "Non définie";
                    result = `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-green-600">Paramètres</h4>
                                <p class="text-sm">α (forme) = ${alpha_p}</p>
                                <p class="text-sm">x_m (minimum) = ${xm}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-green-600">Moments</h4>
                                <p class="text-sm">Moyenne = ${mean_p}</p>
                                <p class="text-sm">Variance = ${var_p}</p>
                                <p class="text-sm">Skewness > 0 (très asymétrique)</p>
                                <p class="text-sm">Kurtosis = ∞ (si α ≤ 4)</p>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('momentsResult').innerHTML = result;
        }

        // Calculateur Black-Scholes
        function calculateBlackScholes() {
            const S = parseFloat(document.getElementById('bsSpot').value);
            const K = parseFloat(document.getElementById('bsStrike').value);
            const r = parseFloat(document.getElementById('bsRate').value) / 100;
            const T = parseFloat(document.getElementById('bsMaturity').value);
            const sigma = parseFloat(document.getElementById('bsVolatility').value) / 100;
            const optionType = document.getElementById('bsType').value;
            
            // Calcul des paramètres d1 et d2
            const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            
            // Calcul du prix
            let price, delta, gamma, theta, vega, rho;
            
            if (optionType === 'call') {
                price = S * normalCDF(d1) - K * Math.exp(-r * T) * normalCDF(d2);
                delta = normalCDF(d1);
                rho = K * T * Math.exp(-r * T) * normalCDF(d2);
            } else {
                price = K * Math.exp(-r * T) * normalCDF(-d2) - S * normalCDF(-d1);
                delta = normalCDF(d1) - 1;
                rho = -K * T * Math.exp(-r * T) * normalCDF(-d2);
            }
            
            // Grecques communes
            gamma = normalPDF(d1) / (S * sigma * Math.sqrt(T));
            theta = -(S * normalPDF(d1) * sigma) / (2 * Math.sqrt(T)) - r * K * Math.exp(-r * T) * normalCDF(optionType === 'call' ? d2 : -d2);
            if (optionType === 'put') theta += r * K * Math.exp(-r * T);
            vega = S * normalPDF(d1) * Math.sqrt(T);
            
            const result = `
                <div class="bg-green-50 border border-green-200 rounded p-4">
                    <h4 class="font-semibold text-green-700 mb-3">Prix et Grecques Black-Scholes</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Prix:</strong> <span class="pricer-result">${price.toFixed(4)}</span></p>
                            <p><strong>Delta (Δ):</strong> ${delta.toFixed(4)}</p>
                            <p><strong>Gamma (Γ):</strong> ${gamma.toFixed(4)}</p>
                        </div>
                        <div>
                            <p><strong>Theta (Θ):</strong> ${theta.toFixed(4)}</p>
                            <p><strong>Vega (ν):</strong> ${(vega/100).toFixed(4)}</p>
                            <p><strong>Rho (ρ):</strong> ${(rho/100).toFixed(4)}</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-600">
                        <p>d₁ = ${d1.toFixed(4)}, d₂ = ${d2.toFixed(4)}</p>
                        <p>Moneyness: ${(S/K).toFixed(4)} | Temps: ${T} an(s) | Vol implicite: ${(sigma*100).toFixed(1)}%</p>
                    </div>
                </div>
            `;
            
            document.getElementById('bsResults').innerHTML = result;
        }

        // Simulateur Monte Carlo
        function calculateMonteCarlo() {
            const optionType = document.getElementById('mcType').value;
            const S0 = parseFloat(document.getElementById('mcSpot').value);
            const K = parseFloat(document.getElementById('mcStrike').value);
            const nsims = parseInt(document.getElementById('mcSims').value);
            
            // Paramètres par défaut
            const r = 0.05;
            const T = 1;
            const sigma = 0.2;
            const dt = 1/252;
            const steps = Math.floor(T / dt);
            
            let payoffs = [];
            let trajectories = [];
            
            for (let i = 0; i < Math.min(nsims, 1000); i++) { // Limite pour l'affichage
                let S = S0;
                let trajectory = [S];
                let sum = S; // Pour options asiatiques
                let max = S; // Pour lookback
                let min = S;
                
                for (let j = 1; j <= steps; j++) {
                    const Z = Math.random() * 2 - 1; // Approximation normale
                    S = S * Math.exp((r - 0.5 * sigma * sigma) * dt + sigma * Math.sqrt(dt) * Z);
                    trajectory.push(S);
                    sum += S;
                    max = Math.max(max, S);
                    min = Math.min(min, S);
                }
                
                let payoff = 0;
                switch(optionType) {
                    case 'european':
                        payoff = Math.max(S - K, 0);
                        break;
                    case 'asian':
                        const avgPrice = sum / (steps + 1);
                        payoff = Math.max(avgPrice - K, 0);
                        break;
                    case 'barrier':
                        // Down-and-out call avec barrière à 80% du spot
                        const barrier = S0 * 0.8;
                        if (min > barrier) {
                            payoff = Math.max(S - K, 0);
                        }
                        break;
                    case 'lookback':
                        payoff = max - K;
                        break;
                }
                
                payoffs.push(Math.exp(-r * T) * payoff);
                if (trajectories.length < 50) { // Limite trajectoires affichées
                    trajectories.push(trajectory);
                }
            }
            
            const price = payoffs.reduce((a, b) => a + b, 0) / payoffs.length;
            const std = Math.sqrt(payoffs.reduce((sum, x) => sum + Math.pow(x - price, 2), 0) / payoffs.length);
            const stderr = std / Math.sqrt(payoffs.length);
            
            const result = `
                <div class="result-box">
                    <h4 class="font-semibold text-green-700 mb-3">Résultats Monte Carlo</h4>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div>
                            <p><strong>Prix estimé:</strong></p>
                            <p class="pricer-result">${price.toFixed(4)}</p>
                        </div>
                        <div>
                            <p><strong>Écart-type:</strong></p>
                            <p>${std.toFixed(4)}</p>
                        </div>
                        <div>
                            <p><strong>Erreur standard:</strong></p>
                            <p>${stderr.toFixed(4)}</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">
                        Intervalle de confiance 95%: [${(price - 1.96*stderr).toFixed(4)}, ${(price + 1.96*stderr).toFixed(4)}]
                    </p>
                </div>
            `;
            
            document.getElementById('mcResults').innerHTML = result;
            
            // Graphique des trajectoires
            if (mcChart) mcChart.destroy();
            
            const ctx = document.getElementById('mcChart').getContext('2d');
            const timeSteps = Array.from({length: steps + 1}, (_, i) => i * dt);
            
            mcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeSteps.map(t => t.toFixed(2)),
                    datasets: trajectories.slice(0, 20).map((traj, idx) => ({
                        label: idx === 0 ? 'Trajectoires simulées' : '',
                        data: traj,
                        borderColor: `rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.6)`,
                        borderWidth: 1,
                        pointRadius: 0,
                        showLine: true,
                        legend: {display: idx === 0}
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Simulation Monte Carlo - ${optionType} option`
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Temps (années)' } },
                        y: { title: { display: true, text: 'Prix du sous-jacent' } }
                    }
                }
            });
        }

        // Calculateur Heston (simplifié)
        function calculateHeston() {
            const S0 = parseFloat(document.getElementById('hestonS0').value);
            const K = parseFloat(document.getElementById('hestonK').value);
            const v0 = parseFloat(document.getElementById('hestonV0').value);
            const kappa = parseFloat(document.getElementById('hestonKappa').value);
            const theta = parseFloat(document.getElementById('hestonTheta').value);
            const rho = parseFloat(document.getElementById('hestonRho').value);
            
            // Approximation simple (le vrai modèle Heston nécessite FFT)
            const T = 1;
            const r = 0.05;
            const avgVol = Math.sqrt((v0 + theta) / 2);
            
            // Utilisation Black-Scholes avec volatilité moyenne
            const d1 = (Math.log(S0 / K) + (r + 0.5 * avgVol * avgVol) * T) / (avgVol * Math.sqrt(T));
            const d2 = d1 - avgVol * Math.sqrt(T);
            const price = S0 * normalCDF(d1) - K * Math.exp(-r * T) * normalCDF(d2);
            
            // Ajustement pour volatilité stochastique
            const volOfVol = 0.3; // Approximation
            const adjustment = 0.5 * volOfVol * volOfVol * rho * Math.sqrt(T);
            const hestonPrice = price + adjustment;
            
            const result = `
                <div class="result-box">
                    <h4 class="font-semibold text-green-700 mb-3">Prix Modèle de Heston (Approximation)</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Prix Heston:</strong> <span class="pricer-result">${hestonPrice.toFixed(4)}</span></p>
                            <p><strong>Prix BS (référence):</strong> ${price.toFixed(4)}</p>
                            <p><strong>Différence:</strong> ${(hestonPrice - price).toFixed(4)}</p>
                        </div>
                        <div>
                            <p><strong>Vol moyenne:</strong> ${(avgVol*100).toFixed(2)}%</p>
                            <p><strong>Corrélation ρ:</strong> ${rho}</p>
                            <p><strong>Mean reversion κ:</strong> ${kappa}</p>
                        </div>
                    </div>
                    <div class="text-xs text-gray-600 mt-2">
                        <p>Note: Implémentation simplifiée. Le modèle complet nécessite la transformée de Fourier.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('hestonResults').innerHTML = result;
        }

        // Calculateur VaR
        function calculateVaR() {
            const method = document.getElementById('varMethod').value;
            const confidence = parseFloat(document.getElementById('varConfidence').value) / 100;
            const horizon = parseInt(document.getElementById('varHorizon').value);
            const portfolio = parseFloat(document.getElementById('varPortfolio').value);
            const annualVol = parseFloat(document.getElementById('varVolatility').value) / 100;
            const annualReturn = parseFloat(document.getElementById('varMean').value) / 100;
            
            // Ajustement pour l'horizon temporel
            const dailyVol = annualVol / Math.sqrt(252);
            const dailyReturn = annualReturn / 252;
            const horizonVol = dailyVol * Math.sqrt(horizon);
            const horizonReturn = dailyReturn * horizon;
            
            let var95, es95, description;
            
            switch(method) {
                case 'parametric':
                    // VaR paramétrique (normale)
                    const z_score = normalInverse(confidence);
                    var95 = portfolio * (horizonReturn - z_score * horizonVol);
                    es95 = portfolio * (horizonReturn - horizonVol * normalPDF(z_score) / (1 - confidence));
                    description = "Méthode paramétrique (distribution normale)";
                    break;
                    
                case 'student':
                    // VaR paramétrique (Student-t)
                    const nu = 5; // Degrés de liberté
                    const t_score = 2.015; // Approximation t(5, 95%)
                    var95 = portfolio * (horizonReturn - t_score * horizonVol * Math.sqrt((nu-2)/nu));
                    es95 = var95 * 1.2; // Approximation ES
                    description = "Méthode paramétrique (Student-t, ν=5)";
                    break;
                    
                case 'historical':
                    // Simulation VaR historique
                    const scenarios = generateHistoricalScenarios(100, horizonReturn, horizonVol);
                    scenarios.sort((a, b) => a - b);
                    const varIndex = Math.floor((1 - confidence) * scenarios.length);
                    var95 = portfolio * scenarios[varIndex];
                    es95 = portfolio * scenarios.slice(0, varIndex + 1).reduce((a, b) => a + b, 0) / (varIndex + 1);
                    description = "Méthode historique (100 scénarios simulés)";
                    break;
                    
                case 'montecarlo':
                    // VaR Monte Carlo
                    const mcScenarios = generateMonteCarloScenarios(1000, horizonReturn, horizonVol);
                    mcScenarios.sort((a, b) => a - b);
                    const mcVarIndex = Math.floor((1 - confidence) * mcScenarios.length);
                    var95 = portfolio * mcScenarios[mcVarIndex];
                    es95 = portfolio * mcScenarios.slice(0, mcVarIndex + 1).reduce((a, b) => a + b, 0) / (mcVarIndex + 1);
                    description = "Monte Carlo (1000 simulations)";
                    break;
            }
            
            const result = `
                <div class="result-box">
                    <h4 class="font-semibold text-green-700 mb-3">Résultats VaR - ${description}</h4>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div class="text-center">
                            <p class="text-xs text-gray-600">VaR ${(confidence*100).toFixed(1)}%</p>
                            <p class="pricer-result text-lg">${Math.abs(var95).toLocaleString()}€</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Expected Shortfall</p>
                            <p class="pricer-result text-lg">${Math.abs(es95).toLocaleString()}€</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">VaR en % du portefeuille</p>
                            <p class="pricer-result text-lg">${(Math.abs(var95)/portfolio*100).toFixed(2)}%</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-600">
                        <p>Horizon: ${horizon} jour(s) | Confiance: ${(confidence*100)}% | Portefeuille: ${portfolio.toLocaleString()}€</p>
                        <p>Volatilité quotidienne: ${(dailyVol*100).toFixed(3)}% | Rendement quotidien: ${(dailyReturn*100).toFixed(3)}%</p>
                    </div>
                </div>
            `;
            
            document.getElementById('varResults').innerHTML = result;
            
            // Graphique de la distribution des P&L
            updateVarChart(method, var95, es95, horizonReturn, horizonVol, portfolio);
        }

        // Fonctions utilitaires pour VaR
        function normalInverse(p) {
            // Approximation inverse normale
            if (p >= 0.5) {
                const t = Math.sqrt(-2 * Math.log(1 - p));
                return t - (2.30753 + 0.27061 * t) / (1 + 0.99229 * t + 0.04481 * t * t);
            } else {
                return -normalInverse(1 - p);
            }
        }

        function generateHistoricalScenarios(n, mean, vol) {
            const scenarios = [];
            for (let i = 0; i < n; i++) {
                // Génération simple avec distribution normale
                const u1 = Math.random();
                const u2 = Math.random();
                const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                scenarios.push(mean + vol * z);
            }
            return scenarios;
        }

        function generateMonteCarloScenarios(n, mean, vol) {
            return generateHistoricalScenarios(n, mean, vol);
        }

        function updateVarChart(method, var95, es95, mean, vol, portfolio) {
            if (varChart) varChart.destroy();
            
            // Génération des données pour l'histogramme
            const scenarios = generateMonteCarloScenarios(1000, mean, vol);
            const returns = scenarios.map(s => s * portfolio);
            
            // Création des bins
            const min = Math.min(...returns);
            const max = Math.max(...returns);
            const nbBins = 30;
            const binWidth = (max - min) / nbBins;
            const bins = Array(nbBins).fill(0);
            const binLabels = [];
            
            for (let i = 0; i < nbBins; i++) {
                binLabels.push((min + i * binWidth).toFixed(0));
                const binStart = min + i * binWidth;
                const binEnd = min + (i + 1) * binWidth;
                bins[i] = returns.filter(r => r >= binStart && r < binEnd).length;
            }
            
            const ctx = document.getElementById('varChart').getContext('2d');
            varChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Fréquence',
                        data: bins,
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribution des P&L - VaR: ${Math.abs(var95).toFixed(0)}€`
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 'P&L (€)' }
                        },
                        y: { 
                            title: { display: true, text: 'Fréquence' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
